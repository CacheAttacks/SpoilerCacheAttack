}
anlyse_time_line(bit_on_vec[,1], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold)
sync_repeat_threshold <- 10
bit_on_repeat_threshold <- 3
bit_off_repeat_threshold <- 1
anlyse_time_line(bit_on_vec[,1], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold)
anlyse_time_line <- function(time_line, bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold){
over_threshold_count <- 0
under_threshold_count <- 0
bit_on <- F
sync_on <- F
slot_counter <- 0
bitstr <- ""
for(i in seq_along(time_line)){
slot_counter <- slot_counter + 1
if(time_line[i]){
over_threshold_count <- over_threshold_count + 1
under_threshold_count <- 0
} else if(!time_line[i]){
under_threshold_count <- under_threshold_count + 1
}
#bit on detected
if(over_threshold_count > bit_on_repeat_threshold){
bit_on <- T
}
#sync on detected
if(over_threshold_count > sync_repeat_threshold){
sync_on <- T
}
#bit off detected
if(under_threshold_count > bit_off_repeat_threshold){
if(bit_on){
bit_off_counter <- slot_counter - over_threshold_count
if(sync_on){
bitstr <- paste0(bitstr, "(", bit_off_counter, ")s")
} else {
bitstr <- paste0(bitstr, "(", bit_off_counter, ")1")
}
slot_counter <- 0
}
under_threshold_count <- 0
over_threshold_count <- 0
bit_on <- F
sync_on <- F
}
}
return(bitstr)
}
anlyse_time_line(bit_on_vec[,1], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold)
mod(sync_counter, 2)
sync_counter %% 2
5 %% 2
grep("([0-9]+)","(40)1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
grep("([0-9]+)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
grep("\([0-9]+\)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
grep("\\([0-9]+\\)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
grep("[0-9]+","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
grep("[0-9]+","1,1,1,1")
grep("[0-9]+","1,1,1,1", value=T)
grep("[0-9]+","1,1,1,1", value=T, perl = T)
grep("[0-9]+","1,1,1,1", value=T, perl = F)
grep("[0-9]","1,1,1,1", value=T, perl = F)
grep("[0-9]","abc1,1,1,1", value=T, perl = F)
grep("[0-9]","abc1,1,1,1", value=F, perl = F)
gregexpr("([0-9]+)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1"))
gregexpr("([0-9]+)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
gregexpr("\\([0-9]+\\)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")
gregexpr("\\([0-9]+\\)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")[[1]]
gregexpr("\\([0-9]+\\)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")[[1]][1]
attr(gregexpr("\\([0-9]+\\)","1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1")[[1]],"match.length")
seq_along(c(1,2,3,5))
substr("sdf",1,2)
substr("(1)",1,4)
substr("(1)",1,3)
substr("(1)",1,2)
140/23
round(140/23)
round(2/1)
round(1/2)
round(1/1.9)
rep(0,4)
paste0(rep(0,4))
paste0(as.string(rep(0,4))
)
paste0(as.character(rep(0,4)))
Reduce(paste0, rep(0,4))
edit_sync_str <- function(sync_str, average_pause_length){
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(pos in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length)
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
#after )
last_pos <- end_pos
}
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 23)
edit_sync_str <- function(sync_str, average_pause_length){
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length)
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
#after )
last_pos <- end_pos
}
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 23)
edit_sync_str <- function(sync_str, average_pause_length){
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length)
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
#after )
last_pos <- end_pos
}
return(final_str)
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 23)
edit_sync_str <- function(sync_str, average_pause_length){
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length)
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
#after )
last_pos <- end_pos
}
return(final_str)
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 23)
edit_sync_str <- function(sync_str, average_pause_length){
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
print(to_replace)
zeros <- round(to_replace / average_pause_length)
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
#after )
last_pos <- end_pos
}
return(final_str)
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 23)
edit_sync_str <- function(sync_str, average_pause_length){
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
print(to_replace)
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(final_str)
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 23)
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 30)
s <- "sdf"
s[0]
s[1]
substr(s,1,1)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,length(sync_str),length(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
print(to_replace)
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(final_str)
}
edit_sync_str("1(29)s(29)1(127)1(29)1(27)1(94)1(31)s(23)1", 30)
edit_sync_str("s(29)1(127)1(29)1(27)1(94)1(31)s", 30)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,length(sync_str),length(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
print(to_replace)
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(substr(final_str,1,length(final_str)))
}
edit_sync_str("s(29)1(127)1(29)1(27)1(94)1(31)s", 30)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,length(sync_str),length(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(substr(final_str,1,length(final_str)))
}
edit_sync_str("s(29)1(127)1(29)1(27)1(94)1(31)s", 30)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,length(sync_str),length(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(final_str)
}
edit_sync_str("s(29)1(127)1(29)1(27)1(94)1(31)s", 30)
length(s)
size(s)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,nchar(sync_str),nchar(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(substr(final_str,1,nchar(final_str)))
}
edit_sync_str("s(29)1(127)1(29)1(27)1(94)1(31)s", 30)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,nchar(sync_str),nchar(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(substr(final_str,2,nchar(final_str)))
}
edit_sync_str("s(29)1(127)1(29)1(27)1(94)1(31)s", 30)
anlyse_time_line <- function(time_line, bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync){
over_threshold_count <- 0
under_threshold_count <- 0
bit_on <- F
bit_on_counter <- 0
sync_counter <- 0
sync_bit_on <- F
slot_counter <- 0
bit_off_counter_sum <- 0
bitstr_between_sync <- ""
bitstr <- ""
for(i in seq_along(time_line)){
slot_counter <- slot_counter + 1
if(time_line[i]){
over_threshold_count <- over_threshold_count + 1
under_threshold_count <- 0
} else if(!time_line[i]){
under_threshold_count <- under_threshold_count + 1
}
#bit on detected
if(over_threshold_count > bit_on_repeat_threshold){
bit_on <- T
}
#sync on detected
if(over_threshold_count > sync_repeat_threshold){
sync_bit_on <- T
}
#bit off detected
if(under_threshold_count > bit_off_repeat_threshold){
if(bit_on){
bit_off_counter <- slot_counter - over_threshold_count
if(sync_bit_on){
sync_counter <- sync_counter + 1
bitstr_between_sync <- paste0(bitstr_between_sync, "(", bit_off_counter, ")s")
if(sync_counter %% 2 == 0){
average_pause_length <- bit_off_counter_sum / (bits_between_sync + 1)
bitstr <- paste0(bitstr, edit_sync_str(bitstr_between_sync, average_pause_length))
bitstr_between_sync <- ""
bit_on_counter <- 0
}
} else {
bit_on_counter <- bit_on_counter + 1
bitstr_between_sync <- paste0(bitstr_between_sync, "(", bit_off_counter, ")1")
}
slot_counter <- 0
bit_off_counter_sum <- bit_off_counter_sum + bit_off_counter
}
under_threshold_count <- 0
over_threshold_count <- 0
bit_on <- F
sync_bit_on <- F
}
}
return(bitstr)
}
anlyse_time_line(bit_on_vec[,1], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
bits_between_sync <- 10
anlyse_time_line(bit_on_vec[,1], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
anlyse_time_line <- function(time_line, bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync){
over_threshold_count <- 0
under_threshold_count <- 0
bit_on <- F
bit_on_counter <- 0
sync_counter <- 0
sync_bit_on <- F
slot_counter <- 0
bit_off_counter_between_sync <- 0
bitstr_between_sync <- ""
bitstr <- ""
for(i in seq_along(time_line)){
slot_counter <- slot_counter + 1
if(time_line[i]){
over_threshold_count <- over_threshold_count + 1
under_threshold_count <- 0
} else if(!time_line[i]){
under_threshold_count <- under_threshold_count + 1
}
#bit on detected
if(over_threshold_count > bit_on_repeat_threshold){
bit_on <- T
}
#sync on detected
if(over_threshold_count > sync_repeat_threshold){
sync_bit_on <- T
}
#bit off detected
if(under_threshold_count > bit_off_repeat_threshold){
if(bit_on){
bit_off_counter <- slot_counter - over_threshold_count
if(sync_bit_on){
sync_counter <- sync_counter + 1
bitstr_between_sync <- paste0(bitstr_between_sync, "(", bit_off_counter, ")s")
if(sync_counter == 1){
bitstr_between_sync <- "s"
bit_off_counter_between_sync <- 0
} else {
average_pause_length <- bit_off_counter_between_sync / (bits_between_sync + 1)
bitstr <- paste0(bitstr, edit_sync_str(bitstr_between_sync, average_pause_length))
bitstr_between_sync <- ""
bit_on_counter <- 0
}
} else {
bit_on_counter <- bit_on_counter + 1
bitstr_between_sync <- paste0(bitstr_between_sync, "(", bit_off_counter, ")1")
}
slot_counter <- 0
bit_off_counter_between_sync <- bit_off_counter_between_sync + bit_off_counter
}
under_threshold_count <- 0
over_threshold_count <- 0
bit_on <- F
sync_bit_on <- F
}
}
return(bitstr)
}
anlyse_time_line(bit_on_vec[,1], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
anlyse_time_line(bit_on_vec[,2], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
edit_sync_str <- function(sync_str, average_pause_length){
if(substr(sync_str,1,1) != "s" || substr(sync_str,nchar(sync_str),nchar(sync_str)) != "s") {
warning("sync_str invalid ", sync_str)
return("invalid")
}
print(sync_str)
final_str <- ""
pos_to_replace <- gregexpr("\\([0-9]+\\)", sync_str)
last_pos <- 0
for(i in seq_along(pos_to_replace[[1]])){
pos <- pos_to_replace[[1]][i]
final_str <- paste0(final_str, substr(sync_str, last_pos, pos-1))
end_pos <- pos + attr(pos_to_replace[[1]],"match.length")[i]
to_replace <- as.numeric(substr(sync_str, pos + 1, end_pos - 2))
zeros <- round(to_replace / average_pause_length) - 1
if(zeros > 0){
final_str <- paste0(final_str, Reduce(paste0, rep(0, zeros)))
}
#after )
last_pos <- end_pos
}
return(substr(final_str,2,nchar(final_str)))
}
anlyse_time_line(bit_on_vec[,2], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
View(bit_on_vec)
anlyse_time_line(bit_on_vec[,3], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
bit_on_repeat_threshold <- 2
anlyse_time_line(bit_on_vec[,2], bit_on_repeat_threshold, bit_off_repeat_threshold,
sync_repeat_threshold, bits_between_sync)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
b <- as.data.frame("689 590 \n475 464 \n470 367 \n449 427 \n461 309 \n395 287 \n401 184 \n362 190 \n372 163 \n353 186 \n395 94 \n342 72 \n159 66 \n141 66 \n133 29 \n70 71 \n77 68 \n76 69 \n80 69 \n76 68 \n80 72 \n78 71 \n79 72 \n82 69 \n76 75 \n78 69 \n79 66 \n81 71 \n75 71 \n72 66 \n80 69 \n78 72 \n79 71 \n78 67 \n76 74 \n81 72 \n81 73 \n74 70 \n73 64 \n71 74 \n76 72 \n76 72 \n77 71 \n78 68 \n80 71 \n80 70 \n80 71 \n79 67 \n82 71 \n78 175 \n")
View(b)
b <- data.frame("689 590 \n475 464 \n470 367 \n449 427 \n461 309 \n395 287 \n401 184 \n362 190 \n372 163 \n353 186 \n395 94 \n342 72 \n159 66 \n141 66 \n133 29 \n70 71 \n77 68 \n76 69 \n80 69 \n76 68 \n80 72 \n78 71 \n79 72 \n82 69 \n76 75 \n78 69 \n79 66 \n81 71 \n75 71 \n72 66 \n80 69 \n78 72 \n79 71 \n78 67 \n76 74 \n81 72 \n81 73 \n74 70 \n73 64 \n71 74 \n76 72 \n76 72 \n77 71 \n78 68 \n80 71 \n80 70 \n80 71 \n79 67 \n82 71 \n78 175 \n")
View(b)
b <- data.table::fread("689 590 \n475 464 \n470 367 \n449 427 \n461 309 \n395 287 \n401 184 \n362 190 \n372 163 \n353 186 \n395 94 \n342 72 \n159 66 \n141 66 \n133 29 \n70 71 \n77 68 \n76 69 \n80 69 \n76 68 \n80 72 \n78 71 \n79 72 \n82 69 \n76 75 \n78 69 \n79 66 \n81 71 \n75 71 \n72 66 \n80 69 \n78 72 \n79 71 \n78 67 \n76 74 \n81 72 \n81 73 \n74 70 \n73 64 \n71 74 \n76 72 \n76 72 \n77 71 \n78 68 \n80 71 \n80 70 \n80 71 \n79 67 \n82 71 \n78 175 \n")
View(b)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
plumber::plumb("plumber.R")$run(port=8000)
